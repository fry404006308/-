# 添加注意力机制步骤

日期: Thu- 2024-03-14 07:37:50

作者: 范仁义

---

🍎

🍓

🍊

🍒

🍌

🍑

🍍

🍉

# 一、找好你要添加的注意力机制代码

以 CBAM 注意力机制为例，默认 yolov8 就包含了 CBAM 的注意力机制的代码

🍇

🍋

🍅

🍐

📖

# 二、放入注意力机制代码

在 `conv.py` 文件下 路径：`ultralytics/nn/modules/conv.py` 放入注意力机制代码

🍧

![1710373376174](image/添加注意力机制步骤/1710373376174.png)

🍓

📒

🔧

# 三、添加这个注意力机制模块

添加这个注意力机制模块，让 yolov8 可以找到它

## 1、在 `conv.py` 的 `__all__`里添加模块名字

![1710373279372](image/添加注意力机制步骤/1710373279372.png)

🌱

🌺

## 2、在 `ultralytics/nn/modules/__init__.py` 添加模块名字

🔥

✨

![1710373553352](image/添加注意力机制步骤/1710373553352.png)

🍹

🧊

![1710373587918](image/添加注意力机制步骤/1710373587918.png)

🍄

🌷

💮

## 3、在 `ultralytics/nn/tasks.py` 添加模块名字

🌸

🍁

![1710373751917](image/添加注意力机制步骤/1710373751917.png)

🌳

🌲

🌴

# 四、添加 yolov8 处理对应模块的代码

🍎

在 `ultralytics/nn/tasks.py` 的 `parse_model` 函数下添加如下解析我们加的注意力机制的模块的代码

🍓

```python
elif m in {CBAM}:
    c1, c2 = ch[f], args[0]
    if c2 != nc:
        c2 = make_divisible(min(c2, max_channels) * width, 8)
    args = [c1, *args[1:]]
```

🍊

![1710374166540](image/添加注意力机制步骤/1710374166540.png)

🍒

🍌

🍑

🍍

🍉

# 五、修改配置文件

🍇

🍋

添加 CBAM 层

🍅

🍐

并且修改如下这些层

📖

🍧

![1710890986933](image/添加注意力机制步骤/1710890986933.png)

🍓

📒

🔧

# 六、出现如下错误

🌱

🌺

原因是模块的变化，导致 yolo 读取的代码是我们 pip install ultralytics 中的代码

而非我们修改注意力机制的代码

🔥

✨

![1710891264282](image/添加注意力机制步骤/1710891264282.png)

🍹

🧊

🍄

# 七、修改模块名，便于区分

🌷

💮

![1710891439106](image/添加注意力机制步骤/1710891439106.png)

🌸

🍁

🌳

# 八、修改库引入

🌲

🌴

## 1、

修改如下文件中的文件引入部分

`240206_Yolov8/ultralytics_fry/ultralytics_fry_base/__init__.py`

🌱

🌺

![1710891604213](image/添加注意力机制步骤/1710891604213.png)

🔥

![1710891817270](image/添加注意力机制步骤/1710891817270.png)

✨

🍹

## 2、

🧊

🍄

修改如下文件中的文件引入部分

`240206_Yolov8/ultralytics_fry/ultralytics_fry_base/models/yolo/model.py`

🌷

💮

![1710891714735](image/添加注意力机制步骤/1710891714735.png)

🌸

![1710891837512](image/添加注意力机制步骤/1710891837512.png)

🍁

🌳

# 九、成功运行

🌲

![1710891913495](image/添加注意力机制步骤/1710891913495.png)

🌴

🌱

🌺

🔥

✨

🍹

🧊

🍄

🌷

💮

🌸

🍁

🌳

🌲

🌴
